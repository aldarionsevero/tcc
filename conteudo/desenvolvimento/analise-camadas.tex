\section{Camadas de Ambiente}
\label{sec:cam-amb}

As camadas apresentam um conjunto de aspectos do sistema e contém as
informações necessárias que definem o comportamento específico para o
estado desejado daquele ambiente. Os atributos de cada camada são variantes
que são consideradas para o \textit{deployment} de uma aplicação. Sendo assim, as
camadas são dependentes para o nível de compatibilidade da configuração.

\subsection{Levantamento de Camadas de Ambiente}
As seguintes camadas foram definidas para representar o estado de configuração do
sistema:
\begin{itemize}
  \item \textit{\textbf{Hardware}}: definições físicas onde o sistema foi implantado.
    (Arquitetura, memória, espaço em disco, etc);
  \item \textit{\textbf{Operation System}}: definições do sistema operacional
    implantado. Distribuição, arquitetura, versão, etc;
  \item \textit{\textbf{Application}}: definições das aplicações instaladas.
    (Aplicações instaladas, dependências, etc);
  \item \textit{\textbf{Configuration}}: definições das configurações das
    aplicações. (Especificações de implantação de aplicação, arquivos
    de configuração);
  \item \textit{\textbf{Service}}: definições dos serviços daemon que estão em
    funcionamento no sistema.
  \item \textit{\textbf{Custom}}: definições criadas especificamente para o
    sistema sem uma forma padrão conhecida.
\end{itemize}

\subsubsection{\textit{Hardware}}
\label{sec:cam-hard}

A camada de \textit{Hardware} contém as definições físicas do sistema.
As informações são referentes as configurações físicas da máquina, como
CPU, arquitetura, memória, espaço em disco, particionamento, etc. O informe desses atributos
são utilizados para a definição da base do ambiente, ou seja, o sistema
operacional e as aplicações podem ter diferentes desempenhos a partir das
configurações de hardware e/ou apresentar comportamentos inesperados no sistema.
Além das aplicações terem seus requisitos mínimos, algumas são desenhadas
para um tipo específico de arquitetura.

A tabela~\ref{tab:atrhard} mostra diversas informações de hardware possíveis de serem extraídas
do sistema a partir de comandos do sistema operacional e também da ferramenta Ohai, 
dependência prevista para a implementação do Cupper (como descrito na 
seção~\ref{sec:tec}). Nem todas essas informações serão úteis para a 
implementação, mas nessa seção fazemos um levantamento geral antes de fazer uma
seleção.

A camada de hardware será uma das camadas a serem analisadas, e a seleção de 
seus atributos irão seguir os critérios descritos na seção~\ref{sec:defcritcamada}.

A tabela~\ref{tab:atrhard} mostra atributos relacionados a CPU, Memória e 
\textit{Moterboard}, e a tabela~\ref{tab:hdmount} mostra atributos relacionados
a partições, armazenamento, dispositivos PCI, USB e dispositivos de rede.

A primeira coluna das tabelas mostra o atributo em questão; a segunda mostra
a origem do atributo, podendo ser um comando do sistema, ou caminho de um arquivo;
a terceira coluna mostra se o atributo é relevante para a aplicação; a quarta mostra se
esse atributo pode ser conseguido por meio do \textit{Ohai}; a quinta coluna 
diz se é viável implementar o acesso a esse atributo e a ultima coluna
diz se o atributo foi selecionado para ser usado pelo \textit{Cupper}.

\begin{table}[H]
\centering
\caption{Atributos Relacionados a CPU, Memória e \textit{Motherboard}}
\label{tab:atrhard}
\begin{tabular}{|c|c|c|c|c|c|}
\hline
\rowcolor[HTML]{C0C0C0} 
Atributo                                                        & Origem    & Relevante? & Ohai & Viável? & Selecionado? \\ \hline
Modelo CPU                                                      & lscpu     & não        & sim  & sim     & não          \\ \hline
\begin{tabular}[c]{@{}c@{}}Modo de \\ Operação CPU\end{tabular} & lscpu     & sim        & sim  & sim     & sim          \\ \hline
Arquitetura CPU                                                 & lscpu     & sim        & sim  & sim     & sim          \\ \hline
Cores                                                           & lscpu     & sim        & sim  & sim     & sim          \\ \hline
Stepping CPU                                                    & lscpu     & não        & sim  & sim     & não          \\ \hline
Frequência CPU                                                  & lscpu     & sim        & sim  & sim     & sim          \\ \hline
Cache CPU                                                       & lscpu     & sim        & sim  & sim     & sim          \\ \hline
Flags CPU                                                       & lscpu     & sim        & sim  & sim     & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}Modelo \\ Motherboard\end{tabular}   & dmidecode & não        & não  & não     & não          \\ \hline
Versão BIOS                                                     & dmidecode & não        & não  & não     & não          \\ \hline
Flags BIOS                                                      & dmidecode & não        & não  & não     & não          \\ \hline
Slots Memória                                                   & dmidecode & não        & sim  & sim     & não          \\ \hline
Marca Memória                                                   & dmidecode & não        & não  & não     & não          \\ \hline
Tamanho Memória                                                 & free      & sim        & sim  & sim     & sim          \\ \hline
Clock Memória                                                   & dmidecode & não        & não  & não     & não          \\ \hline
Total Swap                                                      & free      & sim        & sim  & sim     & sim          \\ \hline
Livre Swap                                                      & free      & sim        & sim  & sim     & sim          \\ \hline
Total Memória                                                   & free      & sim        & sim  & sim     & sim          \\ \hline
Livre Memória                                                   & free      & sim        & sim  & sim     & sim          \\ \hline
Buffers Memóra                                                  & free      & sim        & sim  & sim     & sim          \\ \hline
Cached Memória                                                  & free      & não        & sim  & sim     & não          \\ \hline
Ativo Memória                                                   & free      & sim        & sim  & sim     & sim          \\ \hline
Inativo Memória                                                 & free      & sim        & sim  & sim     & sim          \\ \hline
Sujo Memória                                                    & pmap      & sim        & sim  & sim     & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}Pag. Anon\\ Memória\end{tabular}     & pmap      & não        & sim  & sim     & não          \\ \hline
\end{tabular}
\end{table}

\begin{table}[H]
\centering
\caption{Atributos relacionados a Partições, Armazenamento, USB, PCI, e Rede}
\label{tab:hdmount}
\begin{tabular}{|c|c|c|c|c|l|}
\hline
\rowcolor[HTML]{C0C0C0} 
Atributo                                                                 & Origem                                                                & Relevante? & Ohai    & Viável & Selecionado? \\ \hline
\begin{tabular}[c]{@{}c@{}}Nome\\ dos\\ Dispositivos\end{tabular}        & lsblk                                                                 & sim        & sim     & sim    & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Major/Minor\\ Dispositivos\end{tabular}       & lsblk                                                                 & sim        & não     & sim    & sim         \\ \hline
Removíveis                                                               & lsblk                                                                 & não        & não     & não    & não         \\ \hline
\begin{tabular}[c]{@{}c@{}}Somente\\ Leitura\end{tabular}                & lsblk                                                                 & não        & não     & não    & não         \\ \hline
Partições                                                                & lsblk                                                                 & sim        & sim     & sim    & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Tamanho\\ Partições/\\ Discos\end{tabular}    & \begin{tabular}[c]{@{}c@{}}lsblk/\\ df\end{tabular}                   & sim        & sim     & sim    & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Tipo\\ Filesystem\\ Dispositivos\end{tabular} & lsblk                                                                 & sim        & sim     & sim    & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}UUID\\ Dispositivos\end{tabular}              & lsblk                                                                 & sim        & sim     & sim    & sim         \\ \hline
Mountpoints                                                              & mount                                                                 & sim        & sim     & sim    & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Dsipositivos\\ USB\end{tabular}               & lsusb                                                                 & não        & não     & não    & não         \\ \hline
\begin{tabular}[c]{@{}c@{}}Dsipositivos\\ PCI\end{tabular}               & lspci                                                                 & sim        & não     & sim    & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Dispositivos \\ de Rede\end{tabular}          & \begin{tabular}[c]{@{}c@{}}lspci/\\ ifconfig/\\ dmidecode\end{tabular} & sim        & sim     & sim    & não         \\ \hline
\end{tabular}
\end{table}


%TODO: adicionar as informações que serão coletadas.

\subsubsection{\textit{Operation System}}
\label{sec:cam-os}

A segunda camada de extração de dados é a do Sistema Operacional. 
Cada sistema tem a sua particularidade com relação aos gerenciamento dos 
recursos de hardware e administração de processos. Portanto é necessário a 
construção de uma arquitetura flexível, que contenha os aspectos em comum aos
sistemas operacionais, e modular para que seja possível escalar a utilização 
da ferramenta para mais Sistemas Operacionais.

Inicialmente a ferramenta Cupper irá abordar dois sistemas operacionais, 
ambos baseados em GNU/Linux: Archlinux e Debian.

A tabela~\ref{tab:so} mostra informações a respeito do Kernel e da distribuição
analisada. Também mostra algumas configurações gerais do sistema, como
configurações de rede.

A primeira coluna das tabelas mostra o atributo em questão; a segunda mostra
a origem do atributo, podendo ser um comando do sistema, ou caminho de um arquivo;
a terceira coluna mostra se o atributo é relevante para a aplicação; a quarta mostra se
esse atributo pode ser conseguido por meio do \textit{Ohai}; a quinta coluna 
diz se é viável implementar o acesso a esse atributo e a ultima coluna
diz se o atributo foi selecionado para ser usado pelo \textit{Cupper}.

\begin{table}[H]
\centering
\caption{Atributos relacionados ao Sistema Operacional, Kernel e configs gerais do sistema}
\label{tab:so}
\begin{tabular}{|c|c|c|c|l|c|}
\hline
\rowcolor[HTML]{C0C0C0} 
Atributo                                                       & Origem               & Relevante? & Ohai & Viável? & Selecionado? \\ \hline
OS                                                             & /etc/distro-release  & sim        & sim  & sim     & sim         \\ \hline
Kernel                                                         & uname                & sim        & sim  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Versão\\ Kernel\end{tabular}        & uname                & sim        & sim  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Machine\\ Kernel\end{tabular}       & uname                & sim        & sim  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Módulos\\ Kernel\end{tabular}       & lsmod                & sim        & sim  & sim     & sim         \\ \hline
Distribuição                                                   & lsb\_release         & sim        & sim  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Release\\ Distribuição\end{tabular} & lsb\_release         & sim        & sim  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Família\\ Distribuição\end{tabular} & lsb\_release         & sim        & sim  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Geren.\\ de Pacotes\end{tabular}    & N/A                  & sim        & não  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Init \\ System\end{tabular}         & N/A                  & sim        & não  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Módulo \\ de Segurança\end{tabular} & N/A                  & sim        & não  & sim     & sim         \\ \hline
Hostname                                                       & hostname             & sim        & sim  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Interfaces\\ de Rede\end{tabular}   & ip                   & sim        & sim  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Endereços\\ de Rede\end{tabular}    & ip                   & sim        & sim  & sim     & sim         \\ \hline
\begin{tabular}[c]{@{}c@{}}Endereços\\ MAC\end{tabular}        & ip                   & sim        & sim  & sim     & sim         \\ \hline
\end{tabular}
\end{table}

Por ser específico de cada distribuição linux, não é possível determinar com um
comando qual o gerenciador de pacotes o sistema utiliza. O mesmo acontece para
o sistema de inicialização de serviços e para o módulo de segurança utilizados.
Dessa forma é necessário implementar a captura dessas informações em um plugin 
para o \textit{Ohai}.

\subsubsection{\textit{Application}}

Essa camada trata das aplicações instaladas no sistema. Aplicações podem ter 
sido instaladas por gerenciadores de pacotes oficiais da distribuição, por
gerenciadores não oficiais, por gerenciadores específicos de módulos para
linguagens e por fim podem ser instalados manualmente. Nessa camada iremos 
suportar somente pacotes instalados por gerenciadores oficiais e por 
gerenciadores específicos de linguagem python e ruby (Pip e RubyGem). Na camada
\textit{Custom} a aplicação irá tentar suportar aplicações instaladas de outras
maneiras.

A primeira coluna das tabelas mostra o atributo em questão; a segunda mostra
a origem do atributo, podendo ser um comando do sistema, ou caminho de um arquivo;
a terceira coluna mostra se o atributo é relevante para a aplicação; a quarta mostra se
esse atributo pode ser conseguido por meio do \textit{Ohai}; a quinta coluna 
diz se é viável implementar o acesso a esse atributo e a ultima coluna
diz se o atributo foi selecionado para ser usado pelo \textit{Cupper}.

\begin{table}[H]
\centering
\caption{Atributos relacionados às Aplicações}
\label{tab:app}
\begin{tabular}{|c|c|c|c|c|c|}
    \hline
    \rowcolor[HTML]{C0C0C0} 
    Atributo                                                         & Origem                                                 & Relevante? & Ohai & Viável & Selecionado? \\ \hline
Pacotes                                                              & \begin{tabular}[c]{@{}c@{}}pacman/\\ dpkg\end{tabular} & sim        & não  & sim    & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}Versões\\ Pacotes\end{tabular}            & \begin{tabular}[c]{@{}c@{}}pacman/\\ dpkg\end{tabular} & sim        & não  & sim    & sim          \\ \hline
Dependências                                                         & \begin{tabular}[c]{@{}c@{}}pacman/\\ dpkg\end{tabular} & sim        & não  & sim    & sim          \\ \hline
Arch                                                                 & \begin{tabular}[c]{@{}c@{}}pacman/\\ dpkg\end{tabular} & sim        & não  & sim    & sim          \\ \hline
    Pacotes Pip                                                      & pip                                                    & sim        & não  & sim    & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}Versões\\ Pacotes Pip\end{tabular}        & pip                                                    & sim        & não  & sim    & sim          \\ \hline
    Pacotes Ruby                                                     & gem                                                    & sim        & não  & sim    & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}Versões\\ Pacotes Ruby\end{tabular}       & gem                                                    & sim        & não  & sim    & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}Pacotes por\\ outro Ger.\end{tabular}     & N/A                                                    & não        & não  & não    & não          \\ \hline
\begin{tabular}[c]{@{}c@{}}Instalação\\ Manual\end{tabular}          & N/A                                                    & não        & não  & não    & não          \\ \hline
\end{tabular}
\end{table}

Nenhum dos atributos dessa camada pode ser extraído pelo \textit{Ohai} por
padrão. Dessa maneira toda a extração desses atributos deverá ser implementada
num plugin para o \textit{Ohai}.

\subsubsection{\textit{Configuration}}

A analise dessa camada está relacionada às configurações específicas de cada 
aplicação, e do sistema. Dados como especificações de implantação das
aplicações e arquivos de configuração são analisados nessa camada.

Para os arquivos de configuração iremos considerar  o sistema de hierarquia de
sistema de arquivos do linux. Alguns arquivos que não seguem o padrão FHS 
(\textit{Filesystem Hierarchy Standard}, Hierarquia de sistema de arquivos) irão
ser tratados na seção~\ref{} de configurações e instalações \textit{Custom}.

A primeira coluna das tabelas mostra o atributo em questão; a segunda mostra
a origem do atributo, podendo ser um comando do sistema, ou caminho de um arquivo;
a terceira coluna mostra se o atributo é relevante para a aplicação; a quarta mostra se
esse atributo pode ser conseguido por meio do \textit{Ohai}; a quinta coluna 
diz se é viável implementar o acesso a esse atributo e a ultima coluna
diz se o atributo foi selecionado para ser usado pelo \textit{Cupper}.

\begin{table}[]
\centering
\caption{Atributos relacionados às Configurações de Aplicações}
\label{tab:config}
\begin{tabular}{|c|c|c|c|c|c|}
\hline
\rowcolor[HTML]{C0C0C0} 
Atributo                                                & Origem                                                          & Relevante? & Ohai & Viável & Selecionado? \\ \hline
\begin{tabular}[c]{@{}c@{}}Host\\ Config\end{tabular}   & /etc                                                            & sim        & não  & sim    & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}Add-on\\ Config\end{tabular} & /etc/opt                                                        & sim        & não  & sim    & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}Sgml\\ Config\end{tabular}   & /etc/sgml                                                       & sim        & não  & sim    & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}X11\\ Config\end{tabular}    & /etc/X11                                                        & sim        & não  & sim    & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}Xml\\ Config\end{tabular}    & /etc/xml                                                        & sim        & não  & sim    & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}User\\ Config\end{tabular}   & \begin{tabular}[c]{@{}c@{}}/home/user/\\ .config\end{tabular}   & sim        & não  & sim    & sim          \\ \hline
\begin{tabular}[c]{@{}c@{}}User\\ Custom\end{tabular}   & \begin{tabular}[c]{@{}c@{}}/home/user/\\ .some-app\end{tabular} & não        & não  & não    & não          \\ \hline
\begin{tabular}[c]{@{}c@{}}Root\\ config\end{tabular}   & /root/*                                                         & não        & não  & não    & não          \\ \hline
\end{tabular}
\end{table}

O padrão HFS já prevê alguns sub diretórios para configurações padrão abaixo de
\textit{/etc/} como \textit{/etc/opt, /etc/X11} por exemplo, mas outros diretórios
de arquivos de configuração são importantes, e seguem praticamente o mesmo padrão.
Não serão analisados todos os subdiretórios, só serão analisados os que estiverem
sobre padrão similar ao HFS.


\subsubsection{\textit{Service}}

Essa camada está relacionada ao gerenciamento de serviços do ambiente.
O gerenciamento de Serviços depende de qual \textit{Init System} é usado pela
distribuição, e em alguns casos, mais de uma abordagem é utilizada por algumas
distribuições.

Existe a maneira de implementar a checagem da presença de um \textit{Init System}
procurando por presença de diretórios e arquivos, mas essa abordagem não é
eficiente. Um exemplo de situação em que isso não funcionaria é a de uma máquina
com Archlinux, ou alguma outra distribuição que siga rolling release, e que 
tenha atualizado seu \textit{Init System} por seguir novos padrões da distribuição.
Por não precisar formatar pra atualizar essa nova abordagem, resquícios da abordagem
anterior continuariam presentes na máquina. Isso é comum em distribuições rolling
release justamente por sua cultura de não formatar e somente atualizar.

Dessa forma, iremos relacionar os \textit{Init Systems} às distribuições
diretamente levando em conta o \textit{Init System} padrão da distribuição.
A tabela~\ref{tab:inits-distro} mostra a relação de \textit{Init System} padrão de cada 
Distribuição. De qualquer maneira o escopo inicial do projeto prevê
implementação somente para \textit{Archlinux} e \textit{Debian}.

\begin{table}[H]
\centering
\caption{Relação entre Distribuições e \textit{Init Systems}}
\label{tab:inits-distro}
\begin{tabular}{c|c|ccccc}
\hline
\rowcolor[HTML]{C0C0C0} 
\multicolumn{1}{|c|}{\cellcolor[HTML]{C0C0C0}systemd} & Upstart                     & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}SysV} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}OpenRC} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}SMF} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}rc} & \multicolumn{1}{c|}{\cellcolor[HTML]{C0C0C0}launchd} \\ \hline
\multicolumn{1}{|c|}{Fedora15}                        & Ubuntu                      & \multicolumn{1}{c|}{RHEL5}                        & \multicolumn{1}{c|}{Gentoo}                         & \multicolumn{1}{c|}{Solaris}                     & \multicolumn{1}{c|}{BSDs}                       & \multicolumn{1}{c|}{OSX}                             \\ \hline
\multicolumn{1}{|c|}{Archlinux}                       & Fedora9                     & \multicolumn{1}{c|}{Debian}                       & \multicolumn{1}{c|}{}                               & \multicolumn{1}{c|}{Opensolaris}                 &                                                 &                                                      \\ \cline{1-3} \cline{5-5}
\multicolumn{1}{|c|}{RHEL7}                           & RHEL6                       & \multicolumn{1}{c|}{Suse}                         & \multicolumn{1}{c|}{}                               & \multicolumn{1}{c|}{illumos}                     &                                                 &                                                      \\ \cline{1-3} \cline{5-5}
\multicolumn{1}{|c|}{openSUSE12}                      & Centos                      &                                                   & \multicolumn{1}{c|}{}                               & \multicolumn{1}{c|}{smartos}                     &                                                 &                                                      \\ \cline{1-2} \cline{5-5}
\multicolumn{1}{l|}{}                                 & \multicolumn{1}{l|}{Debian} & \multicolumn{1}{l}{}                              & \multicolumn{1}{l}{}                                & \multicolumn{1}{l}{}                             & \multicolumn{1}{l}{}                            & \multicolumn{1}{l}{}                                 \\ \cline{2-2}
\end{tabular}
\end{table}




\subsubsection{\textit{Custom}}

%TODO: a seleção de camadas e profundidade de análise serão postas dentro das
%   especificações de cada camada.

